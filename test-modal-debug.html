<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Modal Permiss√µes</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/user-management.css">
    <style>
        body { padding: 20px; font-family: Arial, sans-serif; }
        .debug-info { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .test-btn { margin: 10px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        
        /* For√ßar visibilidade dos bot√µes para teste */
        .force-visible {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
            z-index: 99999 !important;
            background: red !important;
            color: white !important;
            border: 2px solid yellow !important;
        }
    </style>
</head>
<body>
    <h1>üîç Debug Modal de Permiss√µes</h1>
    
    <div class="debug-info">
        <h3>Testes Dispon√≠veis:</h3>
        <button class="test-btn" onclick="openModal()">1. Abrir Modal</button>
        <button class="test-btn" onclick="debugButtons()">2. Debug Bot√µes</button>
        <button class="test-btn" onclick="forceButtonsVisible()">3. For√ßar Visibilidade</button>
        <button class="test-btn" onclick="testCloseModal()">4. Testar Fechar</button>
        <button class="test-btn" onclick="inspectCSS()">5. Inspecionar CSS</button>
        <button class="test-btn" onclick="checkButtonsExistence()">6. Verificar Exist√™ncia</button>
        <button class="test-btn" onclick="highlightButtons()">7. Destacar Bot√µes</button>
    </div>

    <div id="debugOutput" class="debug-info">
        <h3>üìä Resultados dos Testes:</h3>
        <div id="results"></div>
    </div>

    <!-- Modal de Permiss√µes -->
    <div class="app-modal" id="rolePermissionsModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="rolePermissionsTitle">Permiss√µes do Perfil - TESTE</h3>
                <button class="btn btn-secondary" onclick="closeRolePermissionsModal()" id="closeBtn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="permissions-overview">
                    <div class="permission-module" data-module="dashboard">
                        <h4>üìä Dashboard</h4>
                        <div class="permission-actions">
                            <label><input type="checkbox" data-action="view"> Visualizar</label>
                            <label><input type="checkbox" data-action="edit"> Editar</label>
                        </div>
                    </div>
                    
                    <div class="permission-module" data-module="vendas">
                        <h4>üí∞ Vendas</h4>
                        <div class="permission-actions">
                            <label><input type="checkbox" data-action="view"> Visualizar</label>
                            <label><input type="checkbox" data-action="create"> Criar</label>
                            <label><input type="checkbox" data-action="edit"> Editar</label>
                            <label><input type="checkbox" data-action="delete"> Excluir</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn" onclick="closeRolePermissionsModal()" id="closeActionBtn">Fechar</button>
                <button type="button" class="btn btn-primary" onclick="saveRolePermissions()">Salvar Permiss√µes</button>
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            results.appendChild(div);
            console.log(message);
        }

        function openModal() {
            log('üîÑ Abrindo modal...');
            const modal = document.getElementById('rolePermissionsModal');
            modal.classList.add('active');
            log('‚úÖ Modal aberto com classe "active"', 'success');
            
            // Verificar se os bot√µes est√£o vis√≠veis
            setTimeout(() => {
                debugButtons();
            }, 100);
        }

        function debugButtons() {
            log('üîç Verificando bot√µes...');
            
            const closeBtn = document.getElementById('closeBtn');
            const closeActionBtn = document.getElementById('closeActionBtn');
            
            if (closeBtn) {
                const style = window.getComputedStyle(closeBtn);
                log(`Bot√£o X - Display: ${style.display}, Visibility: ${style.visibility}, Opacity: ${style.opacity}`);
                log(`Bot√£o X - Position: ${style.position}, Z-index: ${style.zIndex}`);
                log(`Bot√£o X - Width: ${style.width}, Height: ${style.height}`);
                log(`Bot√£o X - Background: ${style.backgroundColor}, Color: ${style.color}`);
                
                const rect = closeBtn.getBoundingClientRect();
                log(`Bot√£o X - Posi√ß√£o: top=${rect.top}, left=${rect.left}, width=${rect.width}, height=${rect.height}`);
                
                if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0') {
                    log('‚ùå Bot√£o X est√° invis√≠vel!', 'error');
                } else {
                    log('‚úÖ Bot√£o X deveria estar vis√≠vel', 'success');
                }
            } else {
                log('‚ùå Bot√£o X n√£o encontrado!', 'error');
            }
            
            if (closeActionBtn) {
                const style = window.getComputedStyle(closeActionBtn);
                log(`Bot√£o Fechar - Display: ${style.display}, Visibility: ${style.visibility}, Opacity: ${style.opacity}`);
                
                if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0') {
                    log('‚ùå Bot√£o Fechar est√° invis√≠vel!', 'error');
                } else {
                    log('‚úÖ Bot√£o Fechar deveria estar vis√≠vel', 'success');
                }
            } else {
                log('‚ùå Bot√£o Fechar n√£o encontrado!', 'error');
            }
        }

        function forceButtonsVisible() {
            log('üîß For√ßando visibilidade dos bot√µes...');
            
            const closeBtn = document.getElementById('closeBtn');
            const closeActionBtn = document.getElementById('closeActionBtn');
            
            if (closeBtn) {
                closeBtn.classList.add('force-visible');
                closeBtn.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important; background: red !important; color: white !important; border: 2px solid yellow !important; z-index: 99999 !important; position: relative !important;';
                log('‚úÖ Bot√£o X for√ßado a ser vis√≠vel', 'success');
            }
            
            if (closeActionBtn) {
                closeActionBtn.classList.add('force-visible');
                closeActionBtn.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important; background: blue !important; color: white !important; border: 2px solid yellow !important; z-index: 99999 !important; position: relative !important;';
                log('‚úÖ Bot√£o Fechar for√ßado a ser vis√≠vel', 'success');
            }
        }

        function closeRolePermissionsModal() {
            log('üîÑ Fechando modal...');
            const modal = document.getElementById('rolePermissionsModal');
            modal.classList.remove('active');
            log('‚úÖ Modal fechado', 'success');
        }

        function testCloseModal() {
            log('üß™ Testando fechamento do modal...');
            closeRolePermissionsModal();
        }

        function saveRolePermissions() {
            log('üíæ Salvando permiss√µes (teste)...');
        }

        function inspectCSS() {
            const modal = document.getElementById('rolePermissionsModal');
            const header = modal.querySelector('.modal-header');
            const closeBtn = header.querySelector('button');
            const actions = modal.querySelector('.modal-actions');
            const actionBtn = actions.querySelector('button');
            
            console.log('=== INSPE√á√ÉO CSS ===');
            console.log('Modal display:', window.getComputedStyle(modal).display);
            console.log('Header display:', window.getComputedStyle(header).display);
            console.log('Close Button display:', window.getComputedStyle(closeBtn).display);
            console.log('Close Button visibility:', window.getComputedStyle(closeBtn).visibility);
            console.log('Close Button opacity:', window.getComputedStyle(closeBtn).opacity);
            console.log('Actions display:', window.getComputedStyle(actions).display);
            console.log('Action Button display:', window.getComputedStyle(actionBtn).display);
            console.log('Action Button visibility:', window.getComputedStyle(actionBtn).visibility);
            console.log('Action Button opacity:', window.getComputedStyle(actionBtn).opacity);
            
            // Verificar se os elementos existem
            console.log('=== ELEMENTOS ===');
            console.log('Modal existe:', !!modal);
            console.log('Header existe:', !!header);
            console.log('Close Button existe:', !!closeBtn);
            console.log('Actions existe:', !!actions);
            console.log('Action Button existe:', !!actionBtn);
            
            // Verificar posicionamento
            console.log('=== POSICIONAMENTO ===');
            if (closeBtn) {
                const rect = closeBtn.getBoundingClientRect();
                console.log('Close Button rect:', rect);
                console.log('Close Button z-index:', window.getComputedStyle(closeBtn).zIndex);
            }
            if (actionBtn) {
                const rect = actionBtn.getBoundingClientRect();
                console.log('Action Button rect:', rect);
                console.log('Action Button z-index:', window.getComputedStyle(actionBtn).zIndex);
            }
        }
        
        function checkButtonsExistence() {
            const modal = document.getElementById('rolePermissionsModal');
            const allButtons = modal.querySelectorAll('button');
            console.log('=== BOT√ïES ENCONTRADOS ===');
            console.log('Total de bot√µes:', allButtons.length);
            allButtons.forEach((btn, index) => {
                console.log(`Bot√£o ${index + 1}:`, btn.textContent, btn.style.display, btn.offsetWidth, btn.offsetHeight);
            });
        }
        
        function highlightButtons() {
            const modal = document.getElementById('rolePermissionsModal');
            const allButtons = modal.querySelectorAll('button');
            
            console.log('=== DESTACANDO BOT√ïES ===');
            allButtons.forEach((btn, index) => {
                // Adicionar borda vermelha e fundo amarelo para destacar
                btn.style.border = '3px solid red !important';
                btn.style.backgroundColor = 'yellow !important';
                btn.style.color = 'black !important';
                btn.style.zIndex = '99999 !important';
                btn.style.position = 'relative !important';
                
                console.log(`Bot√£o ${index + 1} destacado:`, btn.textContent);
            });
            
            // Tamb√©m destacar os containers
            const header = modal.querySelector('.modal-header');
            const actions = modal.querySelector('.modal-actions');
            
            if (header) {
                header.style.border = '2px solid blue';
                header.style.backgroundColor = 'lightblue';
            }
            
            if (actions) {
                actions.style.border = '2px solid green';
                actions.style.backgroundColor = 'lightgreen';
            }
        }

        // Adicionar eventos de teclado
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('rolePermissionsModal');
                if (modal.classList.contains('active')) {
                    log('‚å®Ô∏è ESC pressionado - fechando modal');
                    closeRolePermissionsModal();
                }
            }
        });

        // Fechar ao clicar no fundo
        document.getElementById('rolePermissionsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                log('üñ±Ô∏è Clique no fundo - fechando modal');
                closeRolePermissionsModal();
            }
        });

        // Log inicial
        log('üöÄ Sistema de debug carregado');
        log('üìù Clique nos bot√µes acima para testar o modal');
    </script>
</body>
</html>